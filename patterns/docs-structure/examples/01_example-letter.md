# 申し送り（2025-01-05 18:30:00）

> **⚠️ 機密情報保護ルール**
>
> この申し送りに記載する情報について:
> - API キー・パスワード・トークンは必ずプレースホルダー(`YOUR_API_KEY`等)で記載
> - 実際の機密情報は絶対に含めない
> - .env や設定ファイルの内容をそのまま転記しない
> - コミット前に git diff で内容を確認
> - プッシュはせずコミットのみ(人間がレビュー後にプッシュ)

## 🔔 Compact前チェックリスト

### トークン使用量の目安
トークン予算の**75-85%**を超えたら申し送り作成を検討しましょう。

- **75%超**: 余裕を持って検討開始
- **85%超**: 早急に申し送り作成
- **100%**: auto compactが発火（文脈が失われる前に記録を！）

> 💡 **トークン使用量の確認方法**
> 会話中に表示される `Token usage: X/Y; Z remaining` を参照
> 例: Claude Codeの場合は予算200,000トークン

### 記録すべき内容を確認
- [x] 現在のセッションで決定した重要事項を記録したか？
- [x] 議論の流れと理由を記録したか？
- [x] 次のセッションで必要な「文脈」「空気感」を言語化したか？
- [x] 技術的な決定の「なぜ」を明記したか？
- [x] 注意事項に新しい学びを追加したか？

---

## 🔍 次のセッション開始時の検証プロトコル

**次のAIへ: セッション開始時に必ず以下を実行してください**

### 1. 前セッションの完了状態を検証
下記の「検証コマンド」を実行し、申し送りの「完了」が実態と一致しているか確認してください。

### 2. 検証結果を人間に報告
- ✅ **全て成功**: 「前セッションの完了状態を確認しました。[次のPhase/タスク]から開始します。」
- ⚠️ **失敗あり**: 「[Phase/タスク名]が未完了でした（理由: [エラー内容]）。[該当箇所]から再開します。」

### 3. 実態ベースで進める
- 申し送りの「完了」は参考程度
- 検証結果が真実

---

## 🔧 コマンド実行ルール

**次のAIへ: コマンド実行前に必ず確認すること**

### 原則：プロジェクトの標準実行方法を探す
実行前に以下を**順番に確認**してから判断：

1. **package.json** の `scripts` セクション（Node.js系）
2. **Makefile** の targets（`make dev`, `make start` など）
3. **docker-compose.yml** の存在（Docker系）
4. **README.md** の Getting Started / Development セクション
5. **pyproject.toml** / **Cargo.toml** など（他言語）

### 禁止事項
- ❌ 確認なしで勝手にサーバー起動
- ❌ `node src/index.js` のような直接実行（scriptsがある場合）
- ❌ ビルド・DB操作を無断実行

### 推奨手順
```bash
# 1. 利用可能な起動方法を調査
ls package.json Makefile docker-compose.yml 2>/dev/null

# 2. 見つかったファイルの内容確認
# 3. 人間に「npm run dev を実行しますか？」と提案
```

**理由**: プロジェクトごとに標準的な起動方法が異なるため

---

## 現在の状況（Phase別 / タスク別）

### Phase 1: ユーザー一覧ページの実装
**ステータス**: ✅ 完了

**完了内容**:
- ✅ `UserListPage.tsx` コンポーネントの作成
- ✅ UI 実装（テーブル表示、ローディング状態、エラー表示）
- ✅ fetch API での `/api/users` への接続実装
- ✅ 型定義（`types/user.ts`）の作成

**検証コマンド** (次のセッションのAIが実行):
```bash
# フロントエンドが起動しているか確認
curl http://localhost:3000

# API が応答するか確認
curl http://localhost:3001/api/users

# TypeScript の型チェック
npm run type-check
```

**検証が失敗した場合の対処**:
- フロントエンドが起動していない → `npm run dev` で起動
- API が応答しない → バックエンドの起動確認 `npm run server`
- 型エラーがある → `types/user.ts` の定義を確認

---

### Phase 2: ユーザー詳細ページの実装
**ステータス**: ⚠️ 部分完了（70%）

**完了内容**:
- ✅ `UserDetailPage.tsx` コンポーネントの作成
- ✅ UI 実装（ユーザー情報の表示、編集ボタン）
- ✅ fetch API での `/api/users/:id` への接続実装

**未完了内容**:
- ⚠️ API 接続の動作検証（実際のユーザーIDでテストしていない）
- ⚠️ エラーハンドリングの追加（404 Not Found の場合など）

**検証コマンド** (次のセッションのAIが実行):
```bash
# 特定ユーザーの取得をテスト
curl http://localhost:3001/api/users/1
curl http://localhost:3001/api/users/999  # 存在しないID

# ブラウザでの動作確認（手動）
# http://localhost:3000/users/1 にアクセス
```

**検証が失敗した場合の対処**:
- 404 エラーが表示されない → エラーハンドリングを `UserDetailPage.tsx:45` に追加
- データが表示されない → fetch の実装を `UserDetailPage.tsx:28` で確認

---

### Phase 3: ユーザー作成・編集機能
**ステータス**: ❌ 未着手

**予定内容**:
- [ ] `UserForm.tsx` コンポーネントの作成
- [ ] POST `/api/users` への接続実装
- [ ] PUT `/api/users/:id` への接続実装
- [ ] バリデーション処理

---

## 次にやること

### 最優先

1. **Phase 2 の API 接続検証**（残り30%）
   - ユーザー詳細ページの動作確認
   - エラーハンドリングの追加（404, 500エラー）
   - 理由: UI 実装が完了しているため、検証するだけ

### 次に

2. **Phase 3: ユーザー作成機能の実装**
   - `UserForm.tsx` の作成
   - POST `/api/users` への接続
   - 推定時間: 2-3時間
   - 理由: CRUD の Create が未実装

3. **Phase 3: ユーザー編集機能の実装**
   - `UserForm.tsx` を編集モードに対応
   - PUT `/api/users/:id` への接続
   - 推定時間: 1-2時間

---

## 注意事項

### 技術的な問題

- **CORS 設定が必要**
  - フロントエンド（localhost:3000）からバックエンド（localhost:3001）へのリクエストが CORS エラーになる可能性
  - 現在は `server/index.js:12` で `cors()` ミドルウェアを設定済み
  - もしエラーが出たら、ミドルウェアの順序を確認

- **API のモックデータを使用中**
  - 現在は `server/routes/users.js` でハードコードされた配列を返している
  - データベース接続は未実装
  - 次フェーズでデータベース（SQLite or PostgreSQL）への移行を検討

### 既知のバグ

- **ユーザー詳細ページで存在しないIDを指定すると白画面**
  - エラーハンドリングが未実装
  - 次セッションで対応必要（Phase 2 の残りタスク）

### 仕様変更の可能性

- **認証機能の追加を検討中**
  - ユーザー作成・編集・削除には認証が必要になる可能性
  - JWT or セッションベース認証を検討
  - 次セッションで要決定 → 必要に応じてノート作成

---

## 技術的な文脈

### 使用技術

- **フロントエンド**: React 18, TypeScript 5, Vite 5
- **バックエンド**: Node.js 20, Express 4.18
- **スタイリング**: CSS Modules
- **状態管理**: useState（将来的に React Query 検討）

### 重要ファイル

```
frontend/src/
├── pages/
│   ├── UserListPage.tsx      # ユーザー一覧（完成）
│   └── UserDetailPage.tsx    # ユーザー詳細（70%完成）
├── types/
│   └── user.ts               # 型定義（完成）
└── api/
    └── users.ts              # API クライアント（一部完成）

server/
├── index.js                  # Express サーバー
└── routes/
    └── users.js              # ユーザー API（モックデータ）
```

### 参考ドキュメント

- [React 18 公式ドキュメント](https://react.dev/)
- [Express 4.x ガイド](https://expressjs.com/en/4x/api.html)
- プロジェクト内ドキュメント（今後作成予定）:
  - `docs/notes/` - API 実装の知見
  - `docs/tasks/` - タスク管理

---

## セッション文脈サマリー

### 核心的な設計決定

- **決定事項**: fetch API を直接使用（ライブラリなし）
  - 理由: シンプルさを優先。将来的に React Query や SWR への移行も容易
  - 影響範囲: `frontend/src/api/` 配下のすべてのファイル

- **決定事項**: モックデータから開始
  - 理由: フロントエンド開発を先行させ、後からデータベースを追加
  - 影響範囲: `server/routes/users.js` のみ（後で差し替え）

### 議論の流れ

1. **最初の問題認識**: ユーザー管理画面が必要
2. **検討したアプローチ**:
   - 案1: 最初からデータベースを用意 → 時間がかかる
   - 案2: モックデータから開始 → 採用（速い）
3. **最終決定**: モックデータで UI を先に完成させ、後でデータベースに接続
4. **残った課題**:
   - エラーハンドリング
   - データベース接続
   - 認証機能

### 次のセッションに引き継ぐべき「空気感」

- **このプロジェクトの優先順位**: スピード優先。動くものを早く作る
- **避けるべきアンチパターン**: 最初から完璧を目指さない。段階的に改善
- **重視している価値観**:
  - シンプルさ > 高度な機能
  - 動作確認 > 完璧なコード
  - 段階的な実装 > 一気に全部
- **現在の開発フェーズ**: プロトタイプ段階（まずは動かす）

---

## 変更履歴
- 2025-01-05 18:30: 初版作成（Phase 1 完了、Phase 2 部分完了）

---

**作成日時**: 2025-01-05 18:30:00
**作成者**: Claude Code + User

---

## 📋 申し送り作成完了時の通知例

申し送りを作成したら、ユーザーに以下の形式で通知してください：

```
申し送りファイルを作成しました: docs/letters/2025-01-05-18-30-00.md

次のClaudeセッションでは、以下のメッセージで開始してください：

---
docs/letters/2025-01-05-18-30-00.md を日本語で。

このプロジェクトの運用ルール

・知見は docs/notes/ (命名: 連番-{title}.md、作成時 README/TEMPLATE参照) ※注意: ノート作成はセッション終了時の申し送りフロー内でのみ実行すること
・申し送りは docs/letters/ (このファイル、作成時 README/TEMPLATE参照) ※注意: 申し送り作成はユーザーが明示的に指示したときのみ実行すること
・コミット: このリポジトリが公開の場合はClaude痕跡（署名・絵文字）なしで、プライベートの場合はClaude痕跡ありでOK

このプロジェクトの起動・再起動・停止・ステータス確認方法

・（起動）npm run dev でフロントエンド起動、npm run server でバックエンド起動
・（再起動）Ctrl+C で停止後、再度起動コマンド実行
・（停止）Ctrl+C
・（ステータス確認方法）curl http://localhost:3000 と curl http://localhost:3001/api/users

---
```

**ポイント:**
- `@` でファイルを明示指定することで確実に読み込まれる
- 「日本語で」を含めることで言語設定も明確化
- 運用ルールを毎回伝えることで、プロジェクト固有の規約を継承
