# actionsパターン セットアップガイド

このガイドは、あなたのプロジェクトに actionsパターン を導入するためのAI向け指示書です。

**対象**: Claude Code などのAIアシスタント
**目的**: actionsパターンを自動的にセットアップする
**バージョン**: 1.0.0

---

## このパターンについて

actionsパターンは、繰り返し実行するタスクを効率化し、トークン消費を約70%削減する仕組みです。

### 核心的な原理

> **「コードで縛る」= 仕様明確 = 議論不要 = トークン節約**

曖昧な会話ベースの指示を、明確な指示書（Markdown）に置き換えることで、確認の往復をゼロにします。

### 効果

- **トークン削減**: 約70%（実測値）
- **時間短縮**: 確認の往復がない → 実行が速い
- **一貫性**: 毎回同じ品質で実行
- **再現性**: チーム全体で共有可能

---

## セットアップ手順

### 1. actionsディレクトリの作成

プロジェクトルートに `actions/` ディレクトリを作成してください。

```bash
mkdir -p actions
```

**配置場所**:
```
project-root/
├── actions/           # ← ここに作成
│   ├── README.md
│   └── *.md          # 各タスクの指示書
├── src/
├── docs/
└── README.md
```

---

### 2. README.md の作成

`actions/README.md` に以下の内容を記述してください：

```markdown
# actions - タスク自動化指示書

このディレクトリには、繰り返し実行するタスクの指示書が格納されています。

## 使い方

Claude Codeなどで以下のように呼び出します：

\`\`\`
@actions/ファイル名.md
\`\`\`

AIが指示書を読み込み、定義されたタスクを実行します。

## 利用可能なアクション

- \`git_commit_and_push.md\` - 進捗のコミットとプッシュ
- \`current_create_knowledge.md\` - 知見のまとめ作成
- \`simple_start_from_latest_letter.md\` - セッション開始（申し送りから）

## 新しいアクションの追加

1. このディレクトリに \`新しいタスク名.md\` を作成
2. 以下の構造で記述：
   - 目的
   - 実行条件
   - 実行手順
   - 注意事項
   - 期待する結果
3. \`@actions/新しいタスク名.md\` で呼び出し

## ヒント

- 指示は具体的に、明確に
- ステップは細かく分割
- 期待する結果を明記
- 繰り返し使って改善
\`\`\`

**ポイント**:
- 使い方を明記
- 利用可能なアクションをリストアップ
- 新しいアクションの追加方法を説明

---

### 3. action.mdファイルの作成

繰り返し実行したいタスクごとに `actions/タスク名.md` を作成します。

#### action.mdファイルの構造

以下のテンプレートに従って記述してください：

```markdown
# タスク名

## 目的
このタスクが何をするか、なぜ必要かを明確に記述

## 実行条件
いつこのタスクを実行すべきか

## 実行手順
1. ステップ1
2. ステップ2
3. ステップ3

## 注意事項
- 注意点1
- 注意点2

## 期待する結果
タスク完了時の状態
```

#### 各セクションの説明

##### 目的
- **何を書く**: このタスクが何をするか、なぜ必要か
- **例**: 「進捗を段階的にコミットし、リモートリポジトリにプッシュする」

##### 実行条件
- **何を書く**: いつこのタスクを実行すべきか
- **例**: 「作業がひと段落したタイミング」

##### 実行手順
- **何を書く**: 具体的なステップを順番に
- **ポイント**:
  - 曖昧な表現を避ける
  - 「いい感じに」ではなく「段階的にコミット」
  - コマンドや手順を明確に

##### 注意事項
- **何を書く**: 実行時の注意点、制約、前提条件
- **例**: 「コミット前に必ずテストを実行する」

##### 期待する結果
- **何を書く**: タスク完了時にどうなっているべきか
- **例**: 「すべての変更がコミットされ、リモートにプッシュされている」

---

### 4. 実用的な例

#### 例1: Git操作

`actions/git_commit_and_push.md`:

```markdown
ではここまで進捗をコミットとプッシュしましょう。段階的に開発や知見がたまったと思うので、段階的に状況をコミットしてください。
```

**ポイント**:
- シンプルで明確
- 「段階的にコミット」と具体的に指示
- 確認不要で即実行可能

#### 例2: 知見まとめ

`actions/current_create_knowledge.md`:

```markdown
ではこの進捗でノートに知見をまとめられそうなものをピックアップしてまとめたいです。まずまとめる計画を教えてください。
```

**ポイント**:
- 「まとめる計画を教えてください」で確認を促す
- 一方的な実行ではなく、計画→実行の流れ
- ユーザーが内容を確認できる

#### 例3: セッション開始

`actions/simple_start_from_latest_letter.md`:

```markdown
このセッションを申し送りからスタートします。最新の申し送りファイルをまず探してから内容を見てください。また、申し送りを見たら、ノートの中から、本プロジェクトでの基本的な起動方法（おそらくスクリプト起動で縛るやり方）や、本プロジェクトでの基本的なテスト手法を探して把握してからスタートしましょう。
```

**ポイント**:
- 複数のステップを明確に指示
- 「まず探して」→「内容を見て」→「把握してから」という流れ
- プロジェクト固有の情報（起動方法、テスト手法）も含む

---

### 5. 使い方

Claude Codeなどで以下のように呼び出します：

```
@actions/タスク名.md
```

**例**:
```
@actions/git_commit_and_push.md
```

AIが指示書を読み込み、タスクを実行します。

**実行の流れ**:
1. User が `@actions/タスク名.md` を呼び出す
2. AI が指示書を読み込む（500トークン程度）
3. AI が指示書に従って即座に実行
4. AI が結果のみを報告（1,000トークン程度）

**従来の会話ベースとの比較**:
- 会話ベース: 6,000-12,000トークン（3-5往復）
- actionsパターン: 1,500-4,000トークン（1-2往復）
- **削減率**: 約70%

---

## カスタマイズ方法

### プロジェクト固有のタスクを追加

1. **タスクを特定**
   - 3回以上繰り返すタスク
   - 手順が決まっているタスク
   - 確認の往復が多いタスク

2. **action.mdを作成**
   ```bash
   touch actions/新しいタスク名.md
   ```

3. **テンプレートに従って記述**
   - 目的を明確に
   - 手順を具体的に
   - 期待する結果を明記

4. **README.mdを更新**
   - 利用可能なアクションのリストに追加

### 既存のaction.mdを編集

プロジェクトの進化に合わせて、既存の指示書を最適化できます。

**編集のポイント**:
- より具体的な手順に変更
- 注意事項を追加
- 期待する結果を明確化

**例**:
```diff
## 実行手順
1. git status で変更を確認
2. git diff で差分を確認
- 3. 適切なコミットメッセージを生成
+ 3. 変更内容に応じて段階的にコミット
+    - 機能追加: "feat: ..."
+    - バグ修正: "fix: ..."
+    - ドキュメント: "docs: ..."
4. git push でリモートに反映
```

### チームで共有

`actions/` ディレクトリをGit管理することで、チーム全体で同じタスク定義を共有できます。

```bash
git add actions/
git commit -m "feat: add actions pattern"
git push
```

**メリット**:
- チーム全体で一貫性が保たれる
- 新メンバーがすぐに使える
- ベストプラクティスが共有される

---

## トラブルシューティング

### Q: AIが指示書を無視する

**原因**:
- 指示が曖昧
- ステップが不明確
- 期待する結果が書かれていない

**解決策**:
1. 指示をより具体的に記述
2. 曖昧な表現（「いい感じに」など）を避ける
3. 期待する結果を明確に書く

**例**:
```diff
## 実行手順
- 1. コミットする
+ 1. git status で変更されたファイルを確認
+ 2. git diff で差分を確認
+ 3. 変更内容に応じて段階的にコミット
+ 4. git push でリモートに反映
```

### Q: トークン削減効果が感じられない

**原因**:
- タスクが複雑すぎる
- 手順が多すぎる
- 1つのaction.mdに複数のタスクが含まれている

**解決策**:
1. タスクを分割
2. 小さなaction.mdに分ける
3. 1ファイル = 1タスクの原則を守る

**例**:
```
❌ actions/git_all.md（コミット、プッシュ、タグ付け、リリース）

✅ actions/git_commit_and_push.md（コミットとプッシュのみ）
✅ actions/git_tag.md（タグ付けのみ）
✅ actions/git_release.md（リリースのみ）
```

### Q: 毎回結果が違う

**原因**:
- 期待する結果が明記されていない
- 手順が曖昧
- 判断基準が不明確

**解決策**:
1. 期待する結果を詳しく書く
2. 判断基準を明確にする
3. 検証手順を追加

**例**:
```diff
## 期待する結果
- すべての変更がコミットされている
+ すべての変更がコミットされ、以下の状態になっている：
+ - git status で "nothing to commit, working tree clean"
+ - git log で最新のコミットが確認できる
+ - リモートに反映されている（git status で "up to date"）
```

### Q: action.mdファイルが多すぎて管理できない

**原因**:
- すべてのタスクをaction.mdにしている
- 一度きりのタスクもaction.md化している

**解決策**:
1. 3回以上使うタスクだけaction.md化
2. カテゴリ別にサブディレクトリを作成
3. README.mdでカテゴリ分け

**例**:
```
actions/
├── README.md
├── git/                    # Git関連
│   ├── commit_and_push.md
│   └── tag.md
├── knowledge/              # 知見管理
│   ├── create_note.md
│   └── create_adr.md
└── session/                # セッション管理
    ├── start.md
    └── end.md
```

---

## ベストプラクティス

### 1. 小さく始める

**最初から完璧を目指さない**:
- まず3つのaction.mdを作成
- 使いながら改善
- 効果を確認してから拡大

**おすすめの最初の3つ**:
1. `git_commit_and_push.md` - Git操作
2. `session_start.md` - セッション開始
3. `create_note.md` - ノート作成

### 2. 繰り返し使って改善

**PDCAサイクル**:
1. **Plan**: action.mdを作成
2. **Do**: 実際に使ってみる
3. **Check**: 効果を確認（トークン数、時間）
4. **Act**: 改善点を反映

**改善の観点**:
- より具体的な手順に変更
- 不要なステップを削除
- 期待する結果を明確化

### 3. チームで共有

**共有のメリット**:
- ベストプラクティスの標準化
- 新メンバーのオンボーディング効率化
- 属人化の防止

**共有方法**:
1. `actions/` ディレクトリをGit管理
2. README.mdに使い方を明記
3. 定期的にレビュー・更新

### 4. ドキュメントと連携

**docs-structureパターンとの組み合わせ**:
- `actions/session_start.md` で申し送りを自動読み込み
- `actions/create_note.md` でノート作成を自動化
- `actions/create_adr.md` でADR作成を自動化

**例**:
```markdown
# actions/session_start.md

このセッションを申し送りからスタートします。
1. docs/letter/ から最新の申し送りを検索
2. 内容を読み込んで理解
3. docs/notes/ から関連するノートを検索
4. 作業を開始
```

---

## まとめ

### actionsパターンのセットアップ手順

1. ✅ `actions/` ディレクトリを作成
2. ✅ `actions/README.md` を作成
3. ✅ 繰り返しタスクを特定
4. ✅ `actions/タスク名.md` を作成
5. ✅ 使って、改善して、共有する

### 効果

- **トークン削減**: 約70%
- **時間短縮**: 約50%
- **一貫性**: 毎回同じ品質
- **再現性**: チーム全体で共有

### 次のステップ

1. [examples/usage-example.md](./examples/usage-example.md) で具体例を確認
2. [WHY.md](./WHY.md) で詳細な原理を理解
3. 自分のプロジェクトで実践
4. 効果を測定して改善

---

**作成日**: 2025-10-25
**バージョン**: 1.0.0
**対象**: Claude Code などのAIアシスタント
