# actions パターン

## 新規に導入する場合

> **🤖 AIへのワンショット指示（コピペ用）**
>
> ```
> https://github.com/1ft-seabass/my-ai-collaboration-patterns/patterns/actions-pattern
> この仕組みを導入したいです。npx degit で構造を持ってきましょう。
>
> npx degit で取得した templates/actions/ 配下のファイル群を、
> templates というフォルダ名ではなく、actions/ 直下に配置してください。
>
> 期待する結果：
>   actions/
>     ├── README.md
>     ├── git_commit_and_push.md
>     ├── current_create_knowledge.md
>     └── simple_start_from_latest_letter.md
>
> NG例（これは避ける）：
>   actions/templates/  ← templatesフォルダを作らない
>   templates/          ← templatesという名前で配置しない
>
> 注: 本リポジトリの最新構成が含まれます。
> 具体的なファイルは actions/README.md を参照してください。
>
> プロジェクトが成熟し、要件が明確になった段階でカスタマイズしてください。
> 初期段階では一般化されたテンプレートのまま使用することを推奨します。
> ```


## 🔄 既存の docs-structure に actions/ を導入・更新する場合

既に docs-structure パターンを導入済みで、docs/actions/ を最新化したい場合:

> **🤖 AIへのワンショット指示（コピペ用）**
>
> ```
> https://github.com/1ft-seabass/my-ai-collaboration-patterns/patterns/actions-pattern
> 既存の docs/ フォルダに最新の actions/ を導入したいです。
>
> 配置先: docs/actions/
>
> 手順:
> 1. このプロジェクトが docs-structure を使っているか確認してください
>    - docs/notes/ ディレクトリが存在するか
>    - docs/letters/ ディレクトリが存在するか
>    - 存在しない場合はエラーを報告して停止（mkdir は絶対にしない）
>
> 2. 一時ディレクトリに最新版を取得
>    - `npx degit 1ft-seabass/my-ai-collaboration-patterns/patterns/actions-pattern/templates/actions /tmp/latest-actions`
>    - 取得成功を確認
>
> 3. 既存ファイルとの差分を確認
>    - 各ファイルについて `diff -u docs/actions/ファイル名 /tmp/latest-actions/ファイル名` を実行
>    - 差分がある場合は diff の出力を提示
>    - 新規追加されるファイル（最新版にあるが既存にない）をリストアップ
>    - 削除されるファイル（既存にあるが最新版にない）をリストアップ
>
> 4. 差分サマリーをユーザーに提示
>    - 変更されるファイル数
>    - 追加されるファイル数
>    - 削除されるファイル数
>    - 主要な変更点の要約
>    - **「この差分で上書きしますか？」と確認**
>
> 5. 承認後に上書き実行
>    - 既存の docs/actions/ 内のファイルをすべて削除
>    - /tmp/latest-actions/ から docs/actions/ にコピー
>    - /tmp/latest-actions/ を削除
>
> 期待する結果:
>   docs/actions/
>     ├── README.md（最新版）
>     └── （最新のアクションファイル群.md）
>
> 注意:
> - 既存のファイルはすべて削除されます
> - カスタムファイルがある場合は、事前にバックアップを推奨します
> - **差分を確認することで、何が変わるかを理解した上で更新できます**
> ```

**更新後の確認:**
- `docs/actions/README.md` を読んで、最新の構成を確認
- `docs/actions/help.md` で使い方をクイックチェック

## 📦 このパターンについて

Claude Code などの AI 協調開発で、繰り返し実行するタスクを明確な指示書（Markdown）として定義することで、会話の往復を減らし、トークン消費を大幅に削減します。

### 解決する問題

- **曖昧な指示による確認の往復**: AIが「どうしますか？」と何度も聞いてくる
- **説明・報告によるトークン浪費**: 毎回同じ説明をAIが繰り返す
- **作業の不一貫性**: 同じタスクでも実行のたびに結果が変わる
- **繰り返し作業の非効率**: 毎回手順を説明し直す必要がある

### このパターンの特徴

- **トークン削減**: 約70%のトークン消費削減（実測値）
- **会話→ツール**: 曖昧な会話ベースから明確な指示書ベースへ
- **一貫性**: 毎回同じ品質で実行
- **再現性**: チーム全体で共有可能
- **拡張性**: 新しいタスクを簡単に追加

## 🚀 使い方

### degit で取得（推奨）

**重要**: `templates` ディレクトリを指定してください。パターン直下ではなく、`templates` 以下がプロジェクトで使用するactionsディレクトリです。

```bash
npx degit 1ft-seabass/my-ai-collaboration-patterns/patterns/actions-pattern/templates ./actions
```

### Git Clone

```bash
git clone https://github.com/1ft-seabass/my-ai-collaboration-patterns.git
cp -r my-ai-collaboration-patterns/patterns/actions-pattern/templates/* ./actions/
```

### AIに読ませる

プロジェクトに配置後、Claude Code などで以下のように呼び出し：

```
@actions/ファイル名.md
```

AIが指示書を読み込み、定義されたタスクを自動実行します。

## 📂 作成される構造

```
actions/
├── README.md                          # actionsディレクトリの説明
└── （複数のアクションファイル.md）   # タスク別の指示書
```

新しいタスクは `actions/新しいタスク名.md` として追加できます。

## 🎯 使用例

### 従来の会話ベース（非効率）

```
User: "プロジェクトの進捗をコミットして"
AI: "どのファイルをコミットしますか？"  ← 確認トークン
User: "全部"
AI: "コミットメッセージは？"  ← さらに確認
User: "いい感じに書いて"
AI: "分かりました。段階的にコミットしますか？"  ← また確認
→ 3往復 × 2000トークン = 6000トークン
```

### actionsパターン（効率的）

```
User: "@actions/ファイル名.md"
[ファイル読み込み: 500トークン]
→ 指示書に手順が明記済み
→ 確認不要で即実行
→ 合計: 1500トークン（75%削減）
```

## 💡 核心的な原理

> **「コードで縛る」= 仕様明確 = 議論不要 = トークン節約**

会話ベースでは、AIは「どうすべきか」を確認するために質問します。しかし、明確な指示書があれば、確認は不要になります。

### なぜ効率的なのか

| 方式 | 特徴 | トークン消費 |
|------|------|-------------|
| **会話ベース** | 曖昧な指示 → 確認の往復 → 説明・報告 | 10,000-15,000 |
| **actionsパターン** | 明確な指示書 → 即実行 → 結果のみ報告 | 3,000-4,000 |
| **削減率** | - | **約70%** |

## 📊 実測データ

実際の joplin-ai-tools プロジェクトでの測定結果：

| タスク | 会話ベース | actions | 削減率 |
|--------|-----------|---------|--------|
| Git操作 | 6,000 | 1,500 | 75% |
| 知見まとめ | 12,000 | 4,000 | 67% |
| セッション開始 | 8,000 | 2,500 | 69% |
| **平均** | **8,667** | **2,667** | **69%** |

**10回の実行での累計**:
- 会話ベース: 86,670トークン
- actionsパターン: 26,670トークン
- **差**: 60,000トークン節約

## ✅ 向いているケース

### 使うべき場面

- ✅ 繰り返し実行するタスク
- ✅ 手順が決まっているタスク
- ✅ 複数のステップがあるタスク
- ✅ 確認が不要なタスク

### 使わない方がいい場面

- ❌ 一度きりのタスク
- ❌ 手順が毎回変わるタスク
- ❌ 探索的なタスク
- ❌ 創造的なタスク

## 🛠️ カスタマイズ

### 新しいアクションの追加

```bash
# 新しいタスク用のファイルを作成
touch actions/新しいタスク名.md
```

`actions/新しいタスク名.md` に以下の構造で記述：

```markdown
# タスク名

## 目的
このタスクが何をするか、なぜ必要か

## 実行条件
いつこのタスクを実行すべきか

## 実行手順
1. ステップ1
2. ステップ2
3. ステップ3

## 注意事項
- 注意点1
- 注意点2

## 期待する結果
タスク完了時の状態
```

### 既存アクションのカスタマイズ

プロジェクト固有の要件に合わせて、`actions/*.md` を編集してください。

## 📖 コアコンセプト

### action.md ファイルとは

- **明確な指示書**: AIが読んで即座に実行できる具体的な手順
- **再現可能**: 毎回同じ結果を生成
- **小さく保つ**: 1ファイル = 1タスク（5-20行が目安）

### 書き方のコツ

- **具体的に**: 「いい感じに」ではなく「段階的にコミット」
- **ステップ分割**: 複雑なタスクは細かく分解
- **期待を明記**: 「何ができていればOK」を書く

## ⚡ 効果

### Before（パターン適用前）

- セッションごとに同じ指示を繰り返す
- AIが確認のために質問攻め
- トークンを大量消費

### After（パターン適用後）

- `@actions/xxx.md` で即座に実行
- 確認なしで一貫した品質
- トークン消費を約70%削減

## 🔗 関連パターン

- [docs-structure](../docs-structure/) - ドキュメント構造（申し送り・ノートで知見を管理）
- [server-management](../server-management/) - サーバー管理（Coming Soon）

## 📚 詳細ドキュメント

詳細な使い方やカスタマイズ方法は以下を参照：
- [WHY.md](./WHY.md) - なぜこのパターンが効果的なのか（詳細分析）
- [GUIDE.md](./GUIDE.md) - AIへのワンショットセットアップ指示
- [examples/](./examples/) - 具体的な使用例

## 🙋 よくある質問

**Q: 既存プロジェクトに導入できる？**
A: 可能です。actionsディレクトリを作成し、頻繁に行うタスクから順に追加してください。

**Q: チーム開発でも使える？**
A: はい。actionsディレクトリをGit管理することで、チーム全体で同じタスク定義を共有できます。

**Q: どのくらい効果がある？**
A: 実測で約70%のトークン削減。繰り返しタスクが多いほど効果的です。

**Q: AIが指示書を無視する場合は？**
A: 指示をより具体的に、明確に記述してください。期待する結果を明記すると効果的です。

## 📝 ライセンス

MIT License - 自由に使用・改変・配布できます

---

**このパターンの実例**: joplin-ai-tools プロジェクトで実運用され、トークン消費を約70%削減した実績があります
