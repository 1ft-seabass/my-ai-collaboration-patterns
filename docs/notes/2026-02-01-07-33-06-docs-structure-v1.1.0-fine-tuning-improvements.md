---
tags: [docs-structure, versioning, workflow, actions, git-commit]
---

# docs-structure v1.1.0 微調整集 - バージョン管理・ワンショット改善・理解チェック

**作成日**: 2026-02-01
**関連タスク**: docs-structure v1.1.0 改修

## 背景

Phase 2（テンプレート更新）と Phase 3（既存ファイル移行）の構想策定が完了した後、実装前に必要な微調整を実施した。
本ノートでは、v1.1.0 に向けて行った6つの改善をまとめる。

---

## 実施した改善

### 1. バージョン管理の導入

**問題**: docs-structure のバージョンが分散管理され、どのバージョンを使っているか不明確

**解決策**: `patterns/docs-structure/VERSION` ファイルを作成

**実装**:
```
patterns/docs-structure/VERSION
内容: 1.0.1
```

**効果**:
- バージョンが一箇所で管理される
- 既存プロジェクトがどのバージョンを使っているか明確
- migration/ の判定ロジックで活用可能

**実装場所**: `patterns/docs-structure/VERSION`

---

### 2. Phase 3 ワンショット構想の策定

**問題**: Phase 3（既存ファイル移行）の詳細設計が Phase 2 と混在していた

**解決策**: Phase 3 を独立したノートに分離

**成果物**: `docs/notes/0028_docs-structure-v1.0.1-to-v1.1.0-migration-oneshot-design.md`

**内容**:
- migration/ ディレクトリ構成の設計
- MIGRATION_GUIDE_v1.0.1_to_v1.1.0.md の完全な仕様
- migration/README.md の完全な仕様
- 汎用的なワンショット指示（どのリポジトリでも使える）

**設計のポイント**:
1. **汎用性**: 特定リポジトリのファイル数を含めない（動的検出）
2. **ワンショット実行**: AI が1セッションで完了できる指示
3. **承認フロー**: 移行計画をユーザーに提示して承認を得る
4. **Phase 2 との整合性**: HTML コメント、Step 構造、トークン削減

**実装場所**: `docs/notes/0028_docs-structure-v1.0.1-to-v1.1.0-migration-oneshot-design.md`

---

### 3. GitHub URL の修正（tree/main 削除）

**問題**: npx degit の URL に不要な `tree/main` が含まれていた

**修正内容**:
```
❌ https://github.com/1ft-seabass/my-ai-collaboration-patterns/tree/main/patterns/docs-structure
✅ https://github.com/1ft-seabass/my-ai-collaboration-patterns/patterns/docs-structure
```

**対象ファイル**:
- `patterns/docs-structure/README.md`
- `patterns/actions-pattern/README.md`
- `patterns/docs-structure-for-target-branch-only/README.md`
- `patterns/writing-collaborate/README.md`
- `patterns/setup-pattern/setup_securecheck/README.md`

**効果**: degit が正常に動作するようになった

---

### 4. コミット時の AI 署名判定ロジック改善

**問題**: `gh` コマンドで公開/非公開を判定していたが、`gh` が入っていない環境が多く、判定が外れる

**新しいアプローチ**:
1. `git log --oneline -10` で従来のコミットスタイルを把握
2. コミットメッセージの形式（`feat:` `fix:` `docs:` など）
3. 日本語 or 英語
4. AI 署名の有無（`Co-Authored-By: Claude` があるか）
5. ユーザーに直接確認
   - このリポジトリは AI 署名を入れますか？ [y/N]
   - コミットメッセージのプレフィックスは？
   - 日本語 or 英語？

**対象ファイル**:
- `patterns/docs-structure/templates/actions/git_commit.md`
- `patterns/docs-structure/templates/actions/00_session_end.md`

**効果**:
- `gh` コマンドへの依存を排除
- 従来のコミットログを参考にすることで一貫性が向上
- ユーザーに直接確認することで確実性が向上

**実装場所**:
- `patterns/docs-structure/templates/actions/git_commit.md:17-26`
- `patterns/docs-structure/templates/actions/00_session_end.md:4-8`

---

### 5. action 指示書の理解チェック機構追加

**問題**: AI が指示書を読んですぐ実行してしまい、ユーザーが何をするか把握できない

**解決策**: 理解チェックセクションを追加

**形式**:
```markdown
## 📋 この指示書の理解チェック

作業を開始する前に、以下の内容を理解したことをチェックボックスで提示してください：

- [ ] 項目1
- [ ] 項目2
- [ ] 項目3

理解できましたか？ゴーサインをください。

---
```

**対象ファイル**（主要4つ）:
- `patterns/docs-structure/templates/actions/doc_note.md`
- `patterns/docs-structure/templates/actions/doc_letter.md`
- `patterns/docs-structure/templates/actions/git_commit.md`
- `patterns/docs-structure/templates/actions/00_session_end.md`

**効果**:
- AI が何をするか事前に提示される
- ユーザーがゴーサインを出してから実行される
- 「承認」ではなく「理解チェック」という形式で心理的負担が軽い

**実装場所**: 各 action ファイルの冒頭

---

### 6. 既存更新セクションの追加・改善（差分確認型）

**問題**: 既存プロジェクトを最新版に更新する際、何が変わるか分からないまま上書きしてしまう

**解決策**: 差分確認型のワンショット指示を追加

**手順**:
1. 一時ディレクトリに最新版を取得（`/tmp/latest-*`）
2. 既存ファイルとの `diff` を実行
3. 差分サマリーをユーザーに提示
   - 変更されるファイル数
   - 追加されるファイル数
   - 削除されるファイル数
   - 主要な変更点の要約
4. **「この差分で上書きしますか？」と確認**
5. 承認後に上書き実行

**対象**:
- `patterns/actions-pattern/README.md`（既存セクションを改善）
- `patterns/docs-structure/README.md`（新規セクションを追加）

**効果**:
- 事故防止（何が変わるか事前に確認できる）
- 理解促進（diff を見ることで変更内容を把握）
- カスタマイズ保護（バックアップの必要性を明示）

**実装場所**:
- `patterns/actions-pattern/README.md:45-70`
- `patterns/docs-structure/README.md:28-82`

---

## まとめ

### 今回の改善の意義

1. **バージョン管理**: VERSION ファイルで明確化
2. **Phase 3 分離**: ワンショット構想を独立ノートに
3. **URL 修正**: degit が正常動作
4. **コミット判定**: gh 依存を排除、一貫性向上
5. **理解チェック**: ユーザーが内容を把握してから実行
6. **差分確認**: 更新時の事故防止

### 次のステップ

これらの微調整により、v1.1.0 の実装準備が整った。

**Phase 2 実装の準備完了**:
- バージョン管理が導入された
- ワンショット指示が改善された
- action の理解チェックが追加された

**Phase 3 実装の準備完了**:
- 詳細設計が 0028 で完成
- 既存更新のワンショット指示が完成

---

## 関連ドキュメント

- [0027: docs-structure v1.0.1 → v1.1.0 改修計画](./0027_docs-structure-v1.0.1-to-v1.1.0-refactoring-plan.md) - Phase 2 の詳細設計
- [0028: docs-structure v1.0.1 → v1.1.0 移行ワンショット設計](./0028_docs-structure-v1.0.1-to-v1.1.0-migration-oneshot-design.md) - Phase 3 の詳細設計

---

**最終更新**: 2026-02-01
**作成者**: Claude Sonnet 4.5 (with 1ft-seabass)
