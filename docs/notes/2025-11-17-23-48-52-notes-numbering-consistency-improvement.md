---
tags: [notes, numbering, refactoring, consistency, git]
---

# ノート連番の一貫性向上 - 開発記録

**作成日**: 2025-11-17
**関連タスク**: ドキュメント管理の改善

## 問題

docs/notes/ ディレクトリのノートファイル連番が不統一で、以下の問題があった：

### 問題の詳細

1. **番号形式の混在**:
   - 2桁: 01-13, 83-86
   - 4桁ゼロパディング: 0014-0015
   - 形式が統一されていない

2. **番号の飛び**:
   - 13 → 0014（番号の飛び + 形式変更）
   - 0015 → 83（大きな飛び）
   - 時系列順になっていない

3. **ソートの問題**:
   ```
   ls で表示した場合:
   01, 02, ..., 09, 10, 11, 12, 13, 0014, 0015, 83, 84, 85, 86
   ```
   - 2桁と4桁が混在して見づらい
   - 将来的に100を超えると問題が発生

### 背景

- 初期は2桁連番（01-13）で作成
- 途中で4桁ゼロパディング（0014-0015）を試験導入
- その後、2桁に戻して83-86を作成
- 結果として、形式が混在して管理が煩雑に

## 解決策

### 全ファイルを4桁ゼロパディングに統一

**方針**:
- 全てのノートを4桁ゼロパディング（0001-9999）に統一
- 時系列順に連番を振り直す
- git mv を使用して履歴を保持

### リネーム計画

```
01 → 0001
02 → 0002
03 → 0003
04 → 0004
05 → 0005
06 → 0006
07 → 0007
08 → 0008
09 → 0009
10 → 0010
11 → 0011
12 → 0012
13 → 0013
0014 → 0014 (変更なし)
0015 → 0015 (変更なし)
83 → 0016
84 → 0017
85 → 0018
86 → 0019
```

**ポイント**:
- 0014-0015は既に4桁なので変更なし
- 83-86は時系列順に0016-0019に変更
- 連番の飛びを解消

## 実装

### 実行コマンド

```bash
# 01-13を4桁に変更
cd docs/notes
git mv 01_degit-understanding.md 0001_degit-understanding.md
git mv 02_pattern-structure-design.md 0002_pattern-structure-design.md
# ... (省略)
git mv 13_avoid-premature-project-specific-customization.md 0013_avoid-premature-project-specific-customization.md

# 83-86を0016-0019に変更
git mv 83_letter-template-improvement.md 0016_letter-template-improvement.md
git mv 84_apply-fullspec-letter-template.md 0017_apply-fullspec-letter-template.md
git mv 85_handoff-workflow-improvement-with-session-prompt.md 0018_handoff-workflow-improvement-with-session-prompt.md
git mv 86_fix-handoff-message-markdown-heading-bug.md 0019_fix-handoff-message-markdown-heading-bug.md
```

### コミット

```bash
git commit -m "refactor: ノート連番を4桁ゼロパディングに統一

- 01-13 → 0001-0013
- 83-86 → 0016-0019
- 0014-0015はそのまま維持

これにより、将来的な拡張性とソートの安定性が向上"

git push
```

### 変更結果

**リネーム済みファイル**: 17ファイル
- 01-13: 13ファイル
- 83-86: 4ファイル

**変更なし**: 2ファイル
- 0014-0015

## 効果

### 1. 一貫性の向上

**Before**:
```
01, 02, ..., 13, 0014, 0015, 83, 84, 85, 86
```

**After**:
```
0001, 0002, ..., 0019
```

すべて4桁ゼロパディングで統一され、一目で理解しやすい。

### 2. ソートの安定性

- どの環境でも同じ順序で表示される
- `ls` コマンドでの表示が自然
- ファイル名でのソートが時系列順と一致

### 3. 将来的な拡張性

- 9999ファイルまで対応可能
- 桁数が変わらないため、スクリプトやツールでの処理が安定
- 追加ファイルは0020, 0021, ... と続ける

### 4. Git履歴の保持

- `git mv` を使用したため、ファイルの履歴が保持される
- `git log --follow` で変更履歴を追跡可能
- リネーム前のファイル名からも検索可能

## 学び

### 1. 早期の標準化の重要性

- プロジェクト開始時に命名規則を決めておくべきだった
- 途中で変更すると、リネーム作業が発生する
- 最初から4桁ゼロパディングにしておけば、この作業は不要だった

### 2. 一貫性の価値

- ファイル名の形式が統一されていると、管理が楽
- 人間にとっても、ツールにとっても扱いやすい
- 小さな不統一が積み重なると、大きな混乱につながる

### 3. Git の rename 検出

- `git mv` を使うことで、リネームとして記録される
- 履歴が保持されるため、安心してリネームできる
- `git log --follow` で追跡可能

### 4. ゼロパディングの利点

**4桁ゼロパディングのメリット**:
- ソートが自然（0001, 0002, ..., 0099, 0100, ...）
- 桁数が固定（スクリプト処理が安定）
- 将来の拡張性（9999まで対応）

**2桁のデメリット**:
- 100を超えると桁数が変わる
- ソートが不安定（1, 10, 100, 2, 20, ...）
- 早期に限界が来る

### 5. 連番の飛びの問題

- 83-86のような飛んだ番号は、後から見ると意味不明
- 時系列順に連番を振り直すことで、理解しやすくなった
- 「なぜ83なのか」という疑問が解消

## 今後の運用

### 新しいノートを追加する場合

1. **最新の番号を確認**:
   ```bash
   ls -1 docs/notes/*.md | tail -1
   # 出力: docs/notes/0019_fix-handoff-message-markdown-heading-bug.md
   ```

2. **次の番号でファイル作成**:
   ```bash
   # 0020 を作成
   cp docs/notes/TEMPLATE.md docs/notes/0020_new-topic.md
   ```

3. **4桁ゼロパディングを維持**:
   - 0020, 0021, 0022, ... と続ける
   - 絶対に2桁や3桁に戻さない

### 番号の確認スクリプト

```bash
# 最新の番号を取得
latest=$(ls -1 docs/notes/*.md | grep -v TEMPLATE | grep -v README | tail -1 | sed 's/.*\/\([0-9]\{4\}\)_.*/\1/')
next=$(printf "%04d" $((10#$latest + 1)))
echo "次のノート番号: $next"
```

## 関連ドキュメント

- [0009_notes-4digit-numbering-change.md](./0009_notes-4digit-numbering-change.md) - 最初の4桁化の試み（0014-0015）
- [docs/notes/README.md](./README.md) - ノート管理のルール
- [docs/notes/TEMPLATE.md](./TEMPLATE.md) - ノートテンプレート

## チェックリスト

整理完了後の確認:
- [x] 全ファイルが4桁ゼロパディング
- [x] 連番に飛びがない（0001-0019）
- [x] Git履歴が保持されている
- [x] リモートにプッシュ済み
- [x] この経緯をノートに記録

---

**最終更新**: 2025-11-17
**作成者**: AI (Claude Sonnet 4.5)
