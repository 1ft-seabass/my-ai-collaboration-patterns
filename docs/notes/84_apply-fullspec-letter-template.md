# 申し送りテンプレート フルスペック版 適用指示書

**このドキュメントについて**: AIが実行するための完全独立型の指示書です。プロジェクト固有の情報に依存せず、どのプロジェクトでも適用可能です。

---

## 実行タスク

現在作業中のプロジェクトにある申し送りテンプレート（`docs/letter/TEMPLATE.md` または類似パス）を、文脈保持機能を強化した**フルスペック版**に更新してください。

---

## 前提条件の確認

### 1. テンプレートファイルの探索

以下の優先順位で申し送りテンプレートを探してください：

1. `docs/letter/TEMPLATE.md`
2. `docs/letters/TEMPLATE.md`
3. `templates/letter/TEMPLATE.md`
4. その他の `**/letter*/TEMPLATE.md` パターン

**探索方法**:
```
Globツールを使用: pattern: "**/letter*/TEMPLATE.md"
```

### 2. 既存テンプレートの確認

- Readツールで既存テンプレートの内容を確認
- 現在の構成を理解してから更新

---

## 更新内容：フルスペック版テンプレート

以下の完全なテンプレートで**既存ファイルを上書き**してください。

```markdown
# 申し送り（YYYY-MM-DD HH:MM:SS）

## 🔔 Compact前チェックリスト

### トークン使用量の目安
トークン予算の**75-85%**を超えたら申し送り作成を検討しましょう。

- **75%超**: 余裕を持って検討開始
- **85%超**: 早急に申し送り作成
- **100%**: auto compactが発火（文脈が失われる前に記録を！）

> 💡 **トークン使用量の確認方法**
> 会話中に表示される `Token usage: X/Y; Z remaining` を参照
> 例: Claude Codeの場合は予算200,000トークン

### 記録すべき内容を確認
- [ ] 現在のセッションで決定した重要事項を記録したか？
- [ ] 議論の流れと理由を記録したか？
- [ ] 次のセッションで必要な「文脈」「空気感」を言語化したか？
- [ ] 技術的な決定の「なぜ」を明記したか？
- [ ] 注意事項に新しい学びを追加したか？

---

## 現在の状況
- 完了: [✓] タスク1
- 進行中: [ ] タスク2（どこまで完了したか具体的に）
- 未着手: [ ] タスク3

## 次にやること
1. 最優先: XXX（理由: ...）
2. 次に: YYY
3. その後: ZZZ

## 注意事項
- ⚠️ XXXは動作しない（理由: ...）
- ⚠️ YYYを変更する場合はZZZも更新必要
- ⚠️ [重要な制約や注意点]

## 技術的な文脈
- 使用技術: [フレームワーク] v[バージョン]
- 重要ファイル: `path/to/file`
- 関連ドキュメント: [リンク]

---

## セッション文脈サマリー

### 核心的な設計決定
- **決定事項**: [何を決めたか]
  - 理由: [なぜその判断をしたか]
  - 影響範囲: [どこに影響するか]

### 議論の流れ
1. **最初の問題認識**: どんな課題から始まったか
2. **検討したアプローチ**: どんな選択肢を考えたか
3. **最終決定**: 何を選び、なぜそれを選んだか
4. **残った課題**: 何が未解決か

### 次のセッションに引き継ぐべき「空気感」
- **このプロジェクトの優先順位**: 何を最も重視しているか
- **避けるべきアンチパターン**: 過去の失敗から学んだこと
- **重視している価値観**: コードの品質、速度、保守性のバランス
- **現在の開発フェーズ**: プロトタイプ/安定化/最適化など

---

## 変更履歴
- YYYY-MM-DD: [変更内容]
- YYYY-MM-DD: [変更内容]

---

**作成日時**: YYYY-MM-DD HH:MM:SS
**作成者**: [名前 or AI]
```

---

## 実行手順

### Step 1: テンプレートファイルの特定

1. Globツールで申し送りテンプレートを検索
2. 見つからない場合は、ユーザーに確認

### Step 2: 既存テンプレートの読み込み

1. Readツールで現在の内容を確認
2. 既存の構造を理解（特にプロジェクト固有のカスタマイズがないか）

### Step 3: フルスペック版の適用

1. Writeツールで上記のテンプレートを適用
2. プロジェクト固有のカスタマイズがあれば、それを保持しつつ新セクションを追加

### Step 4: 完了報告

ユーザーに以下を報告：
- 更新したファイルパス
- 追加された主要なセクション（Compact前チェックリスト、セッション文脈サマリー）
- テンプレートの行数（参考情報）

---

## プロジェクト固有のカスタマイズへの対応

### 基本方針
- **標準的な構成**: そのままフルスペック版を適用
- **カスタマイズあり**: 既存のカスタマイズを保持しつつ、新セクションを追加

### カスタマイズ例と対処

#### 例1: セクション名が異なる
既存: `## 進捗状況` → フルスペック版: `## 現在の状況`

**対処**: 既存のセクション名を尊重し、新セクション（Compact前チェックリスト、セッション文脈サマリー）のみ追加

#### 例2: プロジェクト固有のセクションがある
既存: `## デプロイ情報` など

**対処**: 既存セクションを保持し、新セクションを適切な位置に挿入

#### 例3: 記入例が異なる
既存: 具体的なプロジェクト名やツール名が記載

**対処**: 既存の記入例を保持し、新セクションは汎用的な例を使用

---

## 特殊ケースの処理

### ケース1: 複数のテンプレートが見つかった場合

パターンごとに異なるテンプレートがある場合（例: `patterns/docs-structure/templates/letters/TEMPLATE.md`、`patterns/writing-collaborate/templates/letters/TEMPLATE.md`）：

**対処**: すべてのテンプレートを同様に更新

### ケース2: テンプレートが見つからない場合

**対処**:
1. ユーザーに確認「申し送りテンプレートが見つかりませんでした。作成しますか？」
2. 承認されたら、`docs/letter/TEMPLATE.md` に新規作成

### ケース3: 既にフルスペック版が適用済み

既存テンプレートに「Compact前チェックリスト」セクションが含まれている場合：

**対処**:
1. ユーザーに報告「既にフルスペック版が適用されています」
2. 更新が必要か確認

---

## 品質チェックポイント

更新後、以下を確認してください：

### 1. 必須セクションの存在確認
- [ ] 🔔 Compact前チェックリスト
- [ ] セッション文脈サマリー
- [ ] 現在の状況
- [ ] 次にやること
- [ ] 注意事項

### 2. 構造の整合性
- [ ] Markdown文法が正しい
- [ ] セクション階層が適切（##、###の使い分け）
- [ ] チェックボックス記法が正しい（`- [ ]`）

### 3. 記入例の適切性
- [ ] プロジェクト非依存の汎用的な例
- [ ] AIが理解しやすい明確な指示
- [ ] 「なぜ」を記録する重要性が伝わる

---

## エラーハンドリング

### エラー1: ファイルが読み込めない

**原因**: パーミッションエラー、存在しないパスなど
**対処**: ユーザーに状況を報告し、正しいパスを確認

### エラー2: 書き込みに失敗

**原因**: ファイルがロックされている、ディスク容量不足など
**対処**: エラー内容をユーザーに報告し、手動での対処を依頼

### エラー3: Markdownパースエラー

**原因**: 既存テンプレートの構造が想定外
**対処**: 既存の構造を可能な限り保持し、安全に新セクションを追加

---

## 実行例

### 成功時の報告例

```
申し送りテンプレートをフルスペック版に更新しました。

更新ファイル:
- docs/letter/TEMPLATE.md

追加されたセクション:
- 🔔 Compact前チェックリスト（トークン使用量の目安、記録内容の確認）
- セッション文脈サマリー（設計決定、議論の流れ、空気感の記録）

テンプレート行数: 約75行

これにより、auto compact前に文脈を保持した申し送りを作成できます。
```

### 複数ファイル更新時の報告例

```
以下の申し送りテンプレートをフルスペック版に更新しました：

1. docs/letter/TEMPLATE.md
2. patterns/docs-structure/templates/letters/TEMPLATE.md
3. patterns/writing-collaborate/templates/letters/TEMPLATE.md

すべてのパターンで統一された文脈保持機能が利用可能になりました。
```

---

## 補足情報

### フルスペック版の設計思想

1. **AI前提**: 人間の心理的負担を考慮せず、網羅性と構造化を優先
2. **環境非依存**: トークン予算を割合（75-85%）で表記
3. **文脈保持**: 「なぜ」の記録を重視
4. **暗黙知の言語化**: 「空気感」や価値判断を明示化

### トークン使用量の目安について

- **75%**: 余裕を持った検討開始ライン
- **85%**: 早急な対応が必要なライン
- **割合ベース**: Claude Code（200k）、Codex等、あらゆる環境で通用

### セッション文脈サマリーの重要性

auto compactで最も失われやすいのは：
- 議論のプロセス
- 決定の理由（「なぜ」）
- プロジェクトの暗黙知（優先順位、価値観）

これらを明示的に記録することで、次のセッションでの文脈継続性が大幅に向上します。

---

**このドキュメントの使い方**:
1. このドキュメント全体をAI（Claude Code等）にコピー&ペースト
2. AIが自動的に上記手順を実行
3. 完了報告を確認

**注意**: このドキュメントは完全に独立しており、外部リンクや特定プロジェクトへの依存はありません。
